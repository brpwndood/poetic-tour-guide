<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poetic Tour Guide</title>
    <!-- Tailwind CSS CDN for styling and icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujZlC1qK/G3bU8h4o3B6B92P2I9g2Jb5m5jR8x2R7e8yD6zU8yA6t3Y8+L/Y3VfQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* bg-gray-900 */
            color: #e2e8f0; /* text-gray-200 */
        }
        .stanza {
            cursor: pointer;
            transition: background-color 0.4s ease-in-out;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        .stanza:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .itinerary-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #a78bfa; /* purple-400 */
        }
        .itinerary-content p {
            margin-bottom: 1rem;
        }
        .itinerary-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .itinerary-content li {
            margin-bottom: 0.25rem;
        }
        .itinerary-content strong {
            font-weight: 700;
            color: #e2e8f0;
        }
        .itinerary-content hr {
            border-top: 1px solid #4a5568; /* gray-600 */
            margin: 2rem 0;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-900 overflow-y-auto">

    <div class="bg-gray-800 p-8 md:p-12 rounded-3xl shadow-xl w-full max-w-sm mx-4 text-center my-8">
        <h1 id="mainTitle" class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 mb-6">
            Poetic Tour Guide
        </h1>
        <p id="subTitle" class="text-gray-400 mb-6">
            Select a capital city and click "GO!" to create a poem and a tour guide.
        </p>

        <!-- Annie's section with 16:9 SVG -->
        <div class="mb-8 flex flex-col items-center">
            <!-- SVG for Annie -->
            <div class="w-full h-auto rounded-3xl overflow-hidden border-4 border-purple-500 mb-4">
                <svg id="annieImage" class="w-full" viewBox="0 0 90 90" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <clipPath id="rect-clip">
                            <rect x="0" y="0" width="160" height="90" rx="10" ry="10"/>
                        </clipPath>
                    </defs>
                    <g clip-path="url(#rect-clip)">
                        <!-- Background and Hair -->
                        <rect x="0" y="0" width="160" height="90" fill="#a78bfa"/>
                        <path d="M80 0c-25 0-40 20-50 40s-10 50-10 70c0 10 5 15 15 15h40c10 0 15-5 15-15s-5-25-5-35c-5-10-15-20-30-20z" fill="#583c2f" transform="translate(-10, -10) scale(1.2)" />
                        <!-- Face shape -->
                        <circle cx="80" cy="50" r="25" fill="#fce4c4" />
                        <!-- Eyes -->
                        <circle cx="70" cy="45" r="3" fill="#4d7c0f" />
                        <circle cx="90" cy="45" r="3" fill="#4d7c0f" />
                        <!-- Mouth -->
                        <path d="M75 55c0 5 5 8 10 8s10-3 10-8" fill="none" stroke="#d53f8c" stroke-width="1.5" stroke-linecap="round" />
                        <!-- Dimples -->
                        <circle cx="72" cy="57" r="1" fill="#fce4c4" />
                        <circle cx="88" cy="57" r="1" fill="#fce4c4" />
                        <!-- Shirt -->
                        <path d="M50 70h60c0 10-10 15-30 15s-30-5-30-15z" fill="#3b82f6" />
                    </g>
                </svg>
            </div>
            <p id="annieGreeting" class="text-lg text-white font-semibold">
                Hi, I'm Annie!
            </p>
        </div>

        <!-- User Input Section -->
        <div class="flex flex-col space-y-4 mb-8">
            <select id="citySelect" class="w-full p-4 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors">
                <option value="" disabled selected>Select a city...</option>
            </select>

            <select id="languageSelect" class="w-full p-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                <option value="en" selected>English</option>
                <option value="fr">FranÃ§ais</option>
                <option value="es">EspaÃ±ol</option>
                <option value="de">Deutsch</option>
                <option value="ja">???</option>
                <option value="zh">??</option>
            </select>
            
            <button id="generateBtn" class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                GO!
            </button>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="mt-8 text-blue-400 font-medium hidden">
            <svg class="animate-spin h-5 w-5 mr-3 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span id="loadingText">Generating content...</span>
        </div>

        <!-- Poem and Itinerary Output Container -->
        <div id="outputContainer" class="mt-8 hidden">
            <!-- Image Container -->
            <div id="imageContainer" class="bg-gray-700 p-4 rounded-lg shadow-inner mb-8 flex justify-center items-center w-[288px] h-[162px] mx-auto overflow-hidden">
                <img id="cityImage" src="" alt="Generated image of the city" class="rounded-lg object-contain" style="display: none;">
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-inner">
                <h2 id="poemTitle" class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 mb-4">Poem</h2>
                <button id="readPoemBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full transition-colors mb-4 hidden">
                    Read Poem with ?TTS
                </button>
                <div id="poemContainer" class="text-left mb-8">
                    <!-- Dynamically generated poem will go here -->
                </div>
                
                <h2 id="itineraryTitle" class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 mb-4">Tour Guide Itinerary</h2>
                <div id="itineraryContainer" class="text-left itinerary-content">
                    <!-- Dynamically generated itinerary will go here -->
                </div>
            </div>
            <button id="downloadPdfBtn" class="mt-8 bg-purple-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-purple-700 transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 hidden">
                Download as PDF
            </button>
        </div>

        <!-- Error Box -->
        <div id="errorBox" class="mt-8 p-4 bg-red-700 text-white rounded-lg shadow-md hidden">
            <span id="errorText">An error occurred. Please try again.</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const citySelect = document.getElementById('citySelect');
            const generateBtn = document.getElementById('generateBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const loadingText = document.getElementById('loadingText');
            const outputContainer = document.getElementById('outputContainer');
            const poemContainer = document.getElementById('poemContainer');
            const itineraryContainer = document.getElementById('itineraryContainer');
            const errorBox = document.getElementById('errorBox');
            const errorText = document.getElementById('errorText');
            const mainTitle = document.getElementById('mainTitle');
            const subTitle = document.getElementById('subTitle');
            const poemTitle = document.getElementById('poemTitle');
            const itineraryTitle = document.getElementById('itineraryTitle');
            const languageSelect = document.getElementById('languageSelect');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const imageContainer = document.getElementById('imageContainer');
            const cityImage = document.getElementById('cityImage');
            const readPoemBtn = document.getElementById('readPoemBtn');
            const annieGreeting = document.getElementById('annieGreeting');
            

            const stanzaColors = [
                '#1d4ed8', '#047857', '#6d28d9', '#be123c', '#ca8a04', '#0d9488'
            ];
            let lastClickedStanza = null;
            let currentImageBase64 = null;
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let audioSource = null;

            const worldCapitals = [
                "Abu Dhabi (United Arab Emirates)", "Abuja (Nigeria)", "Accra (Ghana)", "Addis Ababa (Ethiopia)", "Algiers (Algeria)", "Amman (Jordan)", "Amsterdam (Netherlands)", "Andorra la Vella (Andorra)", "Ankara (Turkey)", "Antananarivo (Madagascar)", "Apia (Samoa)", "Ashgabat (Turkmenistan)", "Asmara (Eritrea)", "Astana (Kazakhstan)", "Athens (Greece)", "Baghdad (Iraq)", "Baku (Azerbaijan)", "Bamako (Mali)", "Bandar Seri Begawan (Brunei)", "Bangkok (Thailand)", "Bangui (Central African Republic)", "Banjul (Gambia)", "Basseterre (Saint Kitts and Nevis)", "Beijing (China)", "Beirut (Lebanon)", "Belgrade (Serbia)", "Belmopan (Belize)", "Berlin (Germany)", "Bern (Switzerland)", "Bishkek (Kyrgyzstan)", "Bissau (Guinea-Bissau)", "Bogota (Colombia)", "Brasilia (Brazil)", "Bratislava (Slovakia)", "Brazzaville (Republic of the Congo)", "Bridgetown (Barbados)", "Brussels (Belgium)", "Bucharest (Romania)", "Budapest (Hungary)", "Buenos Aires (Argentina)", "Bujumbura (Burundi)", "Cairo (Egypt)", "Canberra (Australia)", "Caracas (Venezuela)", "Castries (Saint Lucia)", "Chisinau (Moldova)", "Copenhagen (Denmark)", "Dakar (Senegal)", "Damascus (Syria)", "Dhaka (Bangladesh)", "Dili (Timor-Leste)", "Djibouti (Djibouti)", "Dodoma (Tanzania)", "Doha (Qatar)", "Dublin (Ireland)", "Dushanbe (Tajikistan)", "Freetown (Sierra Leone)", "Gaborone (Botswana)", "George Town (Cayman Islands)", "Guatemala City (Guatemala)", "Hanoi (Vietnam)", "Harare (Zimbabwe)", "Havana (Cuba)", "Helsinki (Finland)", "Honiara (Solomon Islands)", "Islamabad (Pakistan)", "Jakarta (Indonesia)", "Jerusalem (Israel)", "Juba (South Sudan)", "Kabul (Afghanistan)", "Kampala (Uganda)", "Kathmandu (Nepal)", "Khartoum (Sudan)", "Kigali (Rwanda)", "Kingston (Jamaica)", "Kinshasa (Democratic Republic of the Congo)", "Kuala Lumpur (Malaysia)", "Kuwait City (Kuwait)", "Kyiv (Ukraine)", "La Paz (Bolivia)", "Libreville (Gabon)", "Lilongwe (Malawi)", "Lima (Peru)", "Lisbon (Portugal)", "Ljubljana (Slovenia)", "Lome (Togo)", "London (United Kingdom)", "Luanda (Angola)", "Lusaka (Zambia)", "Luxembourg (Luxembourg)", "Madrid (Spain)", "Male (Maldives)", "Manama (Bahrain)", "Manila (Philippines)", "Maputo (Mozambique)", "Maseru (Lesotho)", "Mbabane (Eswatini)", "Melekeok (Palau)", "Mexico City (Mexico)", "Minsk (Belarus)", "Mogadishu (Somalia)", "Monaco (Monaco)", "Monrovia (Liberia)", "Montevideo (Uruguay)", "Moroni (Comoros)", "Moscow (Russia)", "Muscat (Oman)", "Nairobi (Kenya)", "Nassau (Bahamas)", "N'Djamena (Chad)", "New Delhi (India)", "Niamey (Niger)", "Nicosia (Cyprus)", "Nouakchott (Mauritania)", "Nuku?alofa (Tonga)", "Nuuk (Greenland)", "Oslo (Norway)", "Ottawa (Canada)", "Ouagadougou (Burkina Faso)", "Palikir (Micronesia)", "Panama City (Panama)", "Papeete (French Polynesia)", "Paramaribo (Suriname)", "Paris (France)", "Phnom Penh (Cambodia)", "Podgorica (Montenegro)", "Port-au-Prince (Haiti)", "Port Louis (Mauritius)", "Port Moresby (Papua New Guinea)", "Port of Spain (Trinidad and Tobago)", "Port Vila (Vanuatu)", "Porto-Novo (Benin)", "Prague (Czech Republic)", "Praia (Cape Verde)", "Pretoria (South Africa)", "Pristina (Kosovo)", "Pyongyang (North Korea)", "Quito (Ecuador)", "Rabat (Morocco)", "Reykjavik (Iceland)", "Riga (Latvia)", "Riyadh (Saudi Arabia)", "Rome (Italy)", "Roseau (Dominica)", "Saint George's (Grenada)", "San Jose (Costa Rica)", "San Marino (San Marino)", "San Salvador (El Salvador)", "Sana'a (Yemen)", "Santiago (Chile)", "Santo Domingo (Dominican Republic)", "Sarajevo (Bosnia and Herzegovina)", "Seoul (South Korea)", "Singapore (Singapore)", "Skopje (North Macedonia)", "Sofia (Bulgaria)", "Stockholm (Sweden)", "Suva (Fiji)", "Taipei (Taiwan)", "Tallinn (Estonia)", "Tashkent (Uzbekistan)", "Tbilisi (Georgia)", "Tegucigalpa (Honduras)", "Tehran (Iran)", "Thimphu (Bhutan)", "Tirana (Albania)", "Tokyo (Japan)", "Tripoli (Libya)", "Tunis (Tunisia)", "Ulaanbaatar (Mongolia)", "Vaduz (Liechtenstein)", "Valletta (Malta)", "Victoria (Seychelles)", "Vienna (Austria)", "Vientiane (Laos)", "Vilnius (Lithuania)", "Warsaw (Poland)", "Washington D.C. (United States)", "Wellington (New Zealand)", "Yamoussoukro (Ivory Coast)", "Yaounde (Cameroon)", "Yaren (Nauru)", "Yerevan (Armenia)", "Zagreb (Croatia)"
            ];

            const appTexts = {
                en: {
                    mainTitle: "Poetic Tour Guide",
                    subTitle: "Select a capital city and click 'GO!' to create a poem and a tour guide.",
                    annieGreeting: "Hi, I'm Annie!",
                    generateBtn: "GO!",
                    readPoemBtn: "Read Poem with ?TTS",
                    loadingText: "Generating content...",
                    itineraryTitle: "Tour Guide Itinerary",
                    selectCity: "Select a city...",
                    selectCityError: "Please select a city first.",
                    apiError: "An error occurred. Please try again.",
                    downloadPdfBtn: "Download as PDF"
                },
                fr: {
                    mainTitle: "Guide Touristique PoÃ©tique",
                    subTitle: "SÃ©lectionnez une capitale et cliquez sur 'GO!' pour gÃ©nÃ©rer un poÃ¨me et un guide.",
                    annieGreeting: "Salut, je suis Annie !",
                    generateBtn: "GO!",
                    readPoemBtn: "Lire le poÃ¨me avec ?TTS",
                    loadingText: "GÃ©nÃ©ration de contenu en cours...",
                    itineraryTitle: "ItinÃ©raire du Guide Touristique",
                    selectCity: "SÃ©lectionnez une ville...",
                    selectCityError: "Veuillez d'abord sÃ©lectionner une ville.",
                    apiError: "Une erreur est survenue. Veuillez rÃ©essayer.",
                    downloadPdfBtn: "TÃ©lÃ©charger en PDF"
                },
                es: {
                    mainTitle: "GuÃ­a TurÃ­stica PoÃ©tica",
                    subTitle: "Seleccione una ciudad capital y haga clic en 'GO!' para crear un poema y una guÃ­a turÃ­stica.",
                    annieGreeting: "Â¡Hola, soy Annie!",
                    generateBtn: "Â¡VAMOS!",
                    readPoemBtn: "Leer poema con ?TTS",
                    loadingText: "Generando contenido...",
                    itineraryTitle: "Itinerario de GuÃ­a TurÃ­stica",
                    selectCity: "Seleccione una ciudad...",
                    selectCityError: "Por favor, seleccione una ciudad primero.",
                    apiError: "OcurriÃ³ un error. Por favor, intÃ©ntelo de nuevo.",
                    downloadPdfBtn: "Descargar como PDF"
                },
                de: {
                    mainTitle: "Poetischer ReisefÃ¼hrer",
                    subTitle: "WÃ¤hlen Sie eine Hauptstadt aus und klicken Sie auf 'GO!', um ein Gedicht und einen ReisefÃ¼hrer zu erstellen.",
                    annieGreeting: "Hallo, ich bin Annie!",
                    generateBtn: "LOS!",
                    readPoemBtn: "Gedicht mit ?TTS lesen",
                    loadingText: "Inhalt wird generiert...",
                    itineraryTitle: "ReisefÃ¼hrer-Route",
                    selectCity: "WÃ¤hlen Sie eine Stadt...",
                    selectCityError: "Bitte wÃ¤hlen Sie zuerst eine Stadt aus.",
                    apiError: "Es ist ein Fehler aufgetreten. Bitte versuchen Sie es erneut.",
                    downloadPdfBtn: "Als PDF herunterladen"
                },
                ja: {
                    mainTitle: "?????????",
                    subTitle: "????????GO!?????????????????????????",
                    annieGreeting: "???????????!",
                    generateBtn: "GO!",
                    readPoemBtn: "?TTS?????",
                    loadingText: "?????????...",
                    itineraryTitle: "????????",
                    selectCity: "???????????...",
                    selectCityError: "??????????????",
                    apiError: "???????????????????????",
                    downloadPdfBtn: "PDF?????????"
                },
                zh: {
                    mainTitle: "????",
                    subTitle: "??????,????â€œGO!â€??????????????",
                    annieGreeting: "?,????!",
                    generateBtn: "GO!",
                    readPoemBtn: "??TTS????",
                    loadingText: "??????...",
                    itineraryTitle: "????",
                    selectCity: "??????...",
                    selectCityError: "?????????",
                    apiError: "?????????",
                    downloadPdfBtn: "???PDF"
                }
            };
            
            const cityTranslations = {
                "Athens": { "ja": "???", "fr": "AthÃ¨nes", "es": "Atenas", "de": "Athen", "zh": "??" },
                "Beijing": { "ja": "??", "fr": "PÃ©kin", "es": "PekÃ­n", "de": "Peking", "zh": "??" },
                "Berlin": { "ja": "????", "fr": "Berlin", "es": "BerlÃ­n", "de": "Berlin", "zh": "??" },
                "Brasilia": { "ja": "?????", "fr": "Brasilia", "es": "Brasilia", "de": "BrasÃ­lia", "zh": "????" },
                "Brussels": { "ja": "??????", "fr": "Bruxelles", "es": "Bruselas", "de": "BrÃ¼ssel", "zh": "????" },
                "Cairo": { "ja": "???", "fr": "Le Caire", "es": "El Cairo", "de": "Kairo", "zh": "??" },
                "Canberra": { "ja": "?????", "fr": "Canberra", "es": "Canberra", "de": "Canberra", "zh": "???" },
                "Copenhagen": { "ja": "???????", "fr": "Copenhague", "es": "Copenhague", "de": "Kopenhagen", "zh": "????" },
                "Dublin": { "ja": "????", "fr": "Dublin", "es": "DublÃ­n", "de": "Dublin", "zh": "???" },
                "Helsinki": { "ja": "?????", "fr": "Helsinki", "es": "Helsinki", "de": "Helsinki", "zh": "?????" },
                "Lisbon": { "ja": "????", "fr": "Lisbonne", "es": "Lisboa", "de": "Lissabon", "zh": "???" },
                "London": { "ja": "????", "fr": "Londres", "es": "Londres", "de": "London", "zh": "??" },
                "Madrid": { "ja": "?????", "fr": "Madrid", "es": "Madrid", "de": "Madrid", "zh": "?????" },
                "Mexico City": { "ja": "???????", "fr": "Mexico", "es": "Ciudad de MÃ©xico", "de": "Mexiko-Stadt", "zh": "???????" },
                "Moscow": { "ja": "????", "fr": "Moscou", "es": "MoscÃº", "de": "Moskau", "zh": "????" },
                "New Delhi": { "ja": "??????", "fr": "New Delhi", "es": "Nueva Delhi", "de": "Neu-Delhi", "zh": "???" },
                "Oslo": { "ja": "???", "fr": "NorvÃ¨ge", "es": "Oslo", "de": "Oslo", "zh": "???" },
                "Ottawa": { "ja": "???", "fr": "Ottawa", "es": "Ottawa", "de": "Ottawa", "zh": "???" },
                "Paris": { "ja": "??", "fr": "Paris", "es": "ParÃ­s", "de": "Paris", "zh": "??" },
                "Prague": { "ja": "???", "fr": "Prague", "es": "Praga", "de": "Prag", "zh": "???" },
                "Rome": { "ja": "???", "fr": "Rome", "es": "Roma", "de": "Rom", "zh": "??" },
                "Stockholm": { "ja": "???????", "fr": "Stockholm", "es": "Estocolmo", "de": "Stockholm", "zh": "???????" },
                "Tokyo": { "ja": "??", "fr": "Tokyo", "es": "Tokio", "de": "Tokio", "zh": "??" },
                "Vienna": { "ja": "????", "fr": "Vienne", "es": "Viena", "de": "Wien", "zh": "???" },
                "Warsaw": { "ja": "?????", "fr": "Varsovie", "es": "Varsovia", "de": "Warschau", "zh": "??" },
                "Washington D.C.": { "ja": "?????D.C.", "fr": "Washington D.C.", "es": "Washington D.C.", "de": "Washington D.C.", "zh": "???" }
            };

            const countryTranslations = {
                "United Arab Emirates": { "ja": "????????", "fr": "Ã‰mirats arabes unis", "es": "Emiratos Ãrabes Unidos", "de": "Vereinigte Arabische Emirate", "zh": "????????" },
                "Nigeria": { "ja": "??????", "fr": "NigÃ©ria", "es": "Nigeria", "de": "Nigeria", "zh": "????" },
                "Ghana": { "ja": "???", "fr": "Ghana", "es": "Ghana", "de": "Ghana", "zh": "??" },
                "Ethiopia": { "ja": "?????", "fr": "Ã‰thiopie", "es": "EtiopÃ­a", "de": "Ã„thiopien", "zh": "?????" },
                "Algeria": { "ja": "??????", "fr": "AlgÃ©rie", "es": "Argelia", "de": "Algerien", "zh": "?????" },
                "Jordan": { "ja": "????", "fr": "Jordanie", "es": "Jordania", "de": "Jordanien", "zh": "??" },
                "Netherlands": { "ja": "????", "fr": "Pays-Bas", "es": "PaÃ­ses Bajos", "de": "Niederlande", "zh": "??" },
                "Andorra": { "ja": "????", "fr": "Andorre", "es": "Andorra", "de": "Andorra", "zh": "???" },
                "Turkey": { "ja": "???", "fr": "Turquie", "es": "TurquÃ­a", "de": "TÃ¼rkei", "zh": "???" },
                "Madagascar": { "ja": "??????", "fr": "Madagascar", "es": "Madagascar", "de": "Madagaskar", "zh": "?????" },
                "Samoa": { "ja": "???", "fr": "Samoa", "es": "Samoa", "de": "Samoa", "zh": "???" },
                "Turkmenistan": { "ja": "????????", "fr": "TurkmÃ©nistan", "es": "TurkmenistÃ¡n", "de": "Turkmenistan", "zh": "?????" },
                "Eritrea": { "ja": "?????", "fr": "Ã‰rythrÃ©e", "es": "Eritrea", "de": "Eritrea", "zh": "?????" },
                "Kazakhstan": { "ja": "??????", "fr": "Kazakhstan", "es": "KazajistÃ¡n", "de": "Kasachstan", "zh": "??????" },
                "Greece": { "ja": "????", "fr": "GrÃ¨ce", "es": "Grecia", "de": "Griechenland", "zh": "??" },
                "Iraq": { "ja": "???", "fr": "Irak", "es": "Irak", "de": "Irak", "zh": "???" },
                "Azerbaijan": { "ja": "????????", "fr": "AzerbaÃ¯djan", "es": "AzerbaiyÃ¡n", "de": "Aserbaidschan", "zh": "????????" },
                "Mali": { "ja": "??", "fr": "Mali", "es": "MalÃ­", "de": "Mali", "zh": "???" },
                "Brunei": { "ja": "????", "fr": "BrunÃ©i", "es": "BrunÃ©i", "de": "Brunei", "zh": "????" },
                "Thailand": { "ja": "??", "fr": "ThaÃ¯lande", "es": "Tailandia", "de": "Thailand", "zh": "??" },
                "Central African Republic": { "ja": "?????????", "fr": "RÃ©publique centrafricaine", "es": "RÃ©publique centrafricaine", "de": "Zentralafrikanische Republik", "zh": "?????" },
                "Gambia": { "ja": "????", "fr": "Gambie", "es": "Gambia", "de": "Gambia", "zh": "????" },
                "Saint Kitts and Nevis": { "ja": "??????Â·????", "fr": "Saint-Christophe-et-NiÃ©vÃ¨s", "es": "San CristÃ³bal y Nieves", "de": "St. Kitts und Nevis", "zh": "??????Â·????" },
                "China": { "ja": "??", "fr": "Chine", "es": "China", "de": "China", "zh": "??" },
                "Lebanon": { "ja": "????", "fr": "Liban", "es": "LÃ­bano", "de": "Libanon", "zh": "????" },
                "Serbia": { "ja": "????", "fr": "Serbie", "es": "Serbia", "de": "Serbien", "zh": "????" },
                "Belize": { "ja": "????", "fr": "Belize", "es": "Belice", "de": "Belize", "zh": "????" },
                "Germany": { "ja": "???", "fr": "Allemagne", "es": "Alemania", "de": "Deutschland", "zh": "???" },
                "Switzerland": { "ja": "???", "fr": "Suisse", "es": "Suiza", "de": "Schweiz", "zh": "???" },
                "Kyrgyzstan": { "ja": "????", "fr": "Kirghizistan", "es": "KirguistÃ¡n", "de": "Kirgisistan", "zh": "????" },
                "Guinea-Bissau": { "ja": "??????", "fr": "GuinÃ©e-Bissau", "es": "Guinea-BisÃ¡u", "de": "Guinea-Bissau", "zh": "??????" },
                "Colombia": { "ja": "?????", "fr": "Colombie", "es": "Colombia", "de": "Kolumbien", "zh": "?????" },
                "Brazil": { "ja": "????", "fr": "BrÃ©sil", "es": "Brasil", "de": "Brasilien", "zh": "????" },
                "Slovakia": { "ja": "?????", "fr": "Slovaquie", "es": "Eslovaquia", "de": "Slowakei", "zh": "?????" },
                "Republic of the Congo": { "ja": "??????", "fr": "RÃ©publique du Congo", "es": "RÃ©publique du Congo", "de": "Republik Kongo", "zh": "??????" },
                "Barbados": { "ja": "?????", "fr": "Barbade", "es": "Barbados", "de": "Barbados", "zh": "?????" },
                "Belgium": { "ja": "????", "fr": "Belgique", "es": "BÃ©lgica", "de": "Belgien", "zh": "????" },
                "Romania": { "ja": "?????", "fr": "Roumanie", "es": "Rumania", "de": "RumÃ¤nien", "zh": "?????" },
                "Hungary": { "ja": "?????", "fr": "Hongrie", "es": "HungrÃ­a", "de": "Ungarn", "zh": "?????" },
                "Argentina": { "ja": "??????", "fr": "Argentine", "es": "Argentina", "de": "Argentinien", "zh": "??????" },
                "Burundi": { "ja": "????", "fr": "Burundi", "es": "Burundi", "de": "Burundi", "zh": "????" },
                "Egypt": { "ja": "????", "fr": "Ã‰gypte", "es": "Egipto", "de": "Ã„gypten", "zh": "????" },
                "Australia": { "ja": "???????", "fr": "Australie", "es": "Australia", "de": "Australien", "zh": "???????" },
                "Venezuela": { "ja": "?????", "fr": "Venezuela", "es": "Venezuela", "de": "Venezuela", "zh": "?????" },
                "Saint Lucia": { "ja": "??????", "fr": "Sainte-Lucie", "es": "Santa LucÃ­a", "de": "St. Lucia", "zh": "????" },
                "Moldova": { "ja": "????", "fr": "Moldavie", "es": "Moldavia", "de": "Moldawien", "zh": "????" },
                "Denmark": { "ja": "?????", "fr": "Danemark", "es": "Dinamarca", "de": "DÃ¤nemark", "zh": "?????" },
                "Senegal": { "ja": "????", "fr": "SÃ©nÃ©gal", "es": "Senegal", "de": "Senegal", "zh": "????" },
                "Syria": { "ja": "???", "fr": "Syrie", "es": "Siria", "de": "Syrien", "zh": "???" },
                "Bangladesh": { "ja": "???????", "fr": "Bangladesh", "es": "BangladÃ©s", "de": "Bangladesch", "zh": "???????" },
                "Timor-Leste": { "ja": "??????", "fr": "Timor-Leste", "es": "Timor Oriental", "de": "Timor-Leste", "zh": "??????" },
                "Djibouti": { "ja": "???", "fr": "Djibouti", "es": "Yibuti", "de": "Dschibuti", "zh": "???" },
                "Tanzania": { "ja": "?????", "fr": "Tanzanie", "es": "Tansania", "de": "Tansania", "zh": "?????" },
                "Qatar": { "ja": "????", "fr": "Qatar", "es": "Catar", "de": "Katar", "zh": "????" },
                "Ireland": { "ja": "??????", "fr": "Irlande", "es": "Irlanda", "de": "Irland", "zh": "??????" },
                "Tajikistan": { "ja": "??????", "fr": "Tadjikistan", "es": "TayikistÃ¡n", "de": "Tadschikistan", "zh": "??????" },
                "Sierra Leone": { "ja": "??????", "fr": "Sierra Leone", "es": "Sierra Leona", "de": "Sierra Leone", "zh": "??????" },
                "Botswana": { "ja": "????", "fr": "Botswana", "es": "Botsuana", "de": "Botswana", "zh": "????" },
                "Cayman Islands": { "ja": "??????", "fr": "ÃŽles CaÃ¯mans", "es": "Islas CaimÃ¡n", "de": "Kaimaninseln", "zh": "????" },
                "Guatemala": { "ja": "?????", "fr": "Guatemala", "es": "Guatemala", "de": "Guatemala", "zh": "?????" },
                "Vietnam": { "ja": "????", "fr": "ViÃªt Nam", "es": "Vietnam", "de": "Vietnam", "zh": "????" },
                "Zimbabwe": { "ja": "?????", "fr": "Zimbabwe", "es": "Zimbabue", "de": "Simbabwe", "zh": "?????" },
                "Cuba": { "ja": "????", "fr": "Cuba", "es": "Cuba", "de": "Kuba", "zh": "????" },
                "Finland": { "ja": "??????", "fr": "Finlande", "es": "Finlandia", "de": "Finnland", "zh": "??????" },
                "Solomon Islands": { "ja": "??????", "fr": "ÃŽles Salomon", "es": "Islas SalomÃ³n", "de": "Salomonen", "zh": "??????" },
                "Pakistan": { "ja": "?????", "fr": "Pakistan", "es": "PakistÃ¡n", "de": "Pakistan", "zh": "?????" },
                "Indonesia": { "ja": "??????", "fr": "IndonÃ©sie", "es": "Indonesia", "de": "Indonesien", "zh": "??????" },
                "Israel": { "ja": "?????", "fr": "IsraÃ«l", "es": "Israel", "de": "Israel", "zh": "?????" },
                "South Sudan": { "ja": "?????", "fr": "Soudan du Sud", "es": "SudÃ¡n del Sur", "de": "SÃ¼dsudan", "zh": "?????" },
                "Afghanistan": { "ja": "???????", "fr": "Afghanistan", "es": "AfganistÃ¡n", "de": "Afghanistan", "zh": "???????" },
                "Uganda": { "ja": "????", "fr": "Ouganda", "es": "Uganda", "de": "Uganda", "zh": "????" },
                "Nepal": { "ja": "????", "fr": "NÃ©pal", "es": "Nepal", "de": "Nepal", "zh": "????" },
                "Sudan": { "ja": "????", "fr": "Soudan", "es": "SudÃ¡n", "de": "Sudan", "zh": "????" },
                "Rwanda": { "ja": "????", "fr": "Rwanda", "es": "Ruanda", "de": "Ruanda", "zh": "????" },
                "Jamaica": { "ja": "?????", "fr": "JamaÃ¯que", "es": "Jamaica", "de": "Jamaika", "zh": "?????" },
                "Democratic Republic of the Congo": { "ja": "????????", "fr": "RÃ©publique dÃ©mocratique du Congo", "es": "RÃ©publique dÃ©mocratique du Congo", "de": "Demokratische Republik Kongo", "zh": "????????" },
                "Malaysia": { "ja": "?????", "fr": "Malaisie", "es": "Malasia", "de": "Malaysia", "zh": "?????" },
                "Kuwait": { "ja": "?????", "fr": "KoweÃ¯t", "es": "Kuwait", "de": "Kuwait", "zh": "?????" },
                "Ukraine": { "ja": "?????", "fr": "Ukraine", "es": "Ucrania", "de": "Ukraine", "zh": "?????" },
                "Bolivia": { "ja": "????", "fr": "Bolivie", "es": "Bolivia", "de": "Bolivien", "zh": "????" },
                "Gabon": { "ja": "???", "fr": "Gabon", "es": "GabÃ³n", "de": "Gabun", "zh": "???" },
                "Malawi": { "ja": "????", "fr": "Malawi", "es": "Malaui", "de": "Malawi", "zh": "????" },
                "Peru": { "ja": "???", "fr": "PÃ©rou", "es": "PerÃº", "de": "Peru", "zh": "???" },
                "Portugal": { "ja": "?????", "fr": "Portugal", "es": "Portugal", "de": "Portugal", "zh": "?????" },
                "Slovenia": { "ja": "?????", "fr": "SlovÃ©nie", "es": "Eslovenia", "de": "Slowenien", "zh": "?????" },
                "Togo": { "ja": "???", "fr": "Togo", "es": "Togo", "de": "Togo", "zh": "???" },
                "United Kingdom": { "ja": "??", "fr": "Royaume-Uni", "es": "Reino Unido", "de": "Vereinigtes KÃ¶nigreich", "zh": "??" },
                "Angola": { "ja": "????", "fr": "Angola", "es": "Angola", "de": "Angola", "zh": "????" },
                "Zambia": { "ja": "????", "fr": "Zambie", "es": "Zambia", "de": "Sambia", "zh": "????" },
                "Luxembourg": { "ja": "???????", "fr": "Luxembourg", "es": "Luxemburgo", "de": "Luxemburg", "zh": "???????" },
                "Spain": { "ja": "????", "fr": "Espagne", "es": "EspaÃ±a", "de": "Spanien", "zh": "????" },
                "Maldives": { "ja": "?????", "fr": "Maldivas", "es": "Maldivas", "de": "Malediven", "zh": "?????" },
                "Bahrain": { "ja": "?????", "fr": "BahreÃ¯n", "es": "BarÃ©in", "de": "Bahrain", "zh": "?????" },
                "Philippines": { "ja": "?????", "fr": "Philippines", "es": "Filipinas", "de": "Philippinen", "zh": "?????" },
                "Mozambique": { "ja": "??????", "fr": "Mozambique", "es": "Mozambique", "de": "Mosambik", "zh": "??????" },
                "Lesotho": { "ja": "???", "fr": "Lesotho", "es": "Lesoto", "de": "Lesotho", "zh": "???" },
                "Eswatini": { "ja": "??????", "fr": "Eswatini", "es": "Esuatini", "de": "Eswatini", "zh": "??????" },
                "Palau": { "ja": "???", "fr": "Palaos", "es": "Palaos", "de": "Palau", "zh": "???" },
                "Mexico": { "ja": "????", "fr": "Mexique", "es": "MÃ©xico", "de": "Mexiko", "zh": "????" },
                "Belarus": { "ja": "?????", "fr": "BiÃ©lorussie", "es": "Bielorrusia", "de": "Belarus", "zh": "?????" },
                "Somalia": { "ja": "????", "fr": "Somalie", "es": "Somalia", "de": "Somalia", "zh": "????" },
                "Monaco": { "ja": "???", "fr": "Monaco", "es": "MÃ³naco", "de": "Monaco", "zh": "???" },
                "Liberia": { "ja": "????", "fr": "Liberia", "es": "Liberia", "de": "Liberia", "zh": "????" },
                "Uruguay": { "ja": "?????", "fr": "Uruguay", "es": "Uruguay", "de": "Uruguay", "zh": "?????" },
                "Comoros": { "ja": "???", "fr": "Comores", "es": "Comoras", "de": "Komoren", "zh": "???" },
                "Russia": { "ja": "???", "fr": "Russie", "es": "Rusia", "de": "Russland", "zh": "???" },
                "Oman": { "ja": "????", "fr": "Oman", "es": "OmÃ¡n", "de": "Oman", "zh": "????" },
                "Kenya": { "ja": "???", "fr": "Kenya", "es": "Kenia", "de": "Kenia", "zh": "???" },
                "Bahamas": { "ja": "???", "fr": "Bahamas", "es": "Bahamas", "de": "Bahamas", "zh": "???" },
                "Chad": { "ja": "???", "fr": "Tchad", "es": "Chad", "de": "Tschad", "zh": "???" },
                "India": { "ja": "???", "fr": "Inde", "es": "India", "de": "Indien", "zh": "???" },
                "Niger": { "ja": "?????", "fr": "Niger", "es": "NÃ­ger", "de": "Niger", "zh": "?????" },
                "Cyprus": { "ja": "????", "fr": "Chypre", "es": "Chipre", "de": "Zypern", "zh": "????" },
                "Mauritania": { "ja": "??????", "fr": "Mauritanie", "es": "Mauritania", "de": "Mauretanien", "zh": "??????" },
                "Tonga": { "ja": "???", "fr": "Tonga", "es": "Tonga", "de": "Tonga", "zh": "???" },
                "Greenland": { "ja": "???????", "fr": "Groenland", "es": "Groenlandia", "de": "GrÃ¶nland", "zh": "???????" },
                "Norway": { "ja": "?????", "fr": "NorvÃ¨ge", "es": "Noruega", "de": "Norwegen", "zh": "?????" },
                "Canada": { "ja": "???", "fr": "Canada", "es": "CanadÃ¡", "de": "Kanada", "zh": "???" },
                "Burkina Faso": { "ja": "???????", "fr": "Burkina Faso", "es": "Burkina Faso", "de": "Burkina Faso", "zh": "???????" },
                "Micronesia": { "ja": "????????", "fr": "MicronÃ©sie", "es": "Micronesia", "de": "Mikronesien", "zh": "??????" },
                "Panama": { "ja": "???", "fr": "Panama", "es": "PanamÃ¡", "de": "Panama", "zh": "???" },
                "French Polynesia": { "ja": "??????????", "fr": "PolynÃ©sie franÃ§aise", "es": "Polynesia Francesa", "de": "FranzÃ¶sisch-Polynesien", "zh": "??????????" },
                "Suriname": { "ja": "????", "fr": "Suriname", "es": "Surinam", "de": "Surinam", "zh": "????" },
                "France": { "ja": "????", "fr": "France", "es": "Francia", "de": "Frankreich", "zh": "????" },
                "Cambodia": { "ja": "?????", "fr": "Cambodge", "es": "Camboya", "de": "Kambodscha", "zh": "?????" },
                "Montenegro": { "ja": "??????", "fr": "MontÃ©nÃ©gro", "es": "Montenegro", "de": "Montenegro", "zh": "??????" },
                "Haiti": { "ja": "???", "fr": "HaÃ¯ti", "es": "HaitÃ­", "de": "Haiti", "zh": "???" },
                "Mauritius": { "ja": "??????", "fr": "Maurice", "es": "Mauricio", "de": "Mauritius", "zh": "??????" },
                "Papua New Guinea": { "ja": "?????????", "fr": "Papouasie-Nouvelle-GuinÃ©e", "es": "PapÃºa Nueva Guinea", "de": "Papua-Neuguinea", "zh": "?????????" },
                "Trinidad and Tobago": { "ja": "??????Â·???", "fr": "TrinitÃ©-et-Tobago", "es": "Trinidad y Tobago", "de": "Trinidad und Tobago", "zh": "??????Â·???" },
                "Vanuatu": { "ja": "????", "fr": "Vanuatu", "es": "Vanuatu", "de": "Vanuatu", "zh": "????" },
                "Benin": { "ja": "???", "fr": "BÃ©nin", "es": "BenÃ­n", "de": "Benin", "zh": "???" },
                "Czech Republic": { "ja": "???", "fr": "RÃ©publique tchÃ¨que", "es": "RÃ©publique tchÃ¨que", "de": "Tschechische Republik", "zh": "??????" },
                "Cape Verde": { "ja": "??????", "fr": "Cap-Vert", "es": "Cabo Verde", "de": "Kap Verde", "zh": "??????" },
                "South Africa": { "ja": "?????", "fr": "Afrique du Sud", "es": "SudÃ¡frica", "de": "SÃ¼dafrika", "zh": "?????" },
                "Kosovo": { "ja": "???", "fr": "Kosovo", "es": "Kosovo", "de": "Kosovo", "zh": "???" },
                "North Korea": { "ja": "???", "fr": "CorÃ©e du Nord", "es": "Corea del Norte", "de": "Nordkorea", "zh": "???" },
                "Ecuador": { "ja": "?????", "fr": "Ã‰quateur", "es": "Ecuador", "de": "Ecuador", "zh": "?????" },
                "Morocco": { "ja": "????", "fr": "Maroc", "es": "Marruecos", "de": "Marokko", "zh": "????" },
                "Iceland": { "ja": "??????", "fr": "Islande", "es": "Islandia", "de": "Island", "zh": "??????" },
                "Latvia": { "ja": "????", "fr": "Lettonie", "es": "Letonia", "de": "Lettland", "zh": "????" },
                "Saudi Arabia": { "ja": "???????", "fr": "Arabie saoudite", "es": "Arabia Saudita", "de": "Saudi-Arabien", "zh": "???????" },
                "Italy": { "ja": "????", "fr": "Italie", "es": "Italia", "de": "Italien", "zh": "????" },
                "Dominica": { "ja": "?????", "fr": "Dominique", "es": "Dominica", "de": "Dominica", "zh": "?????" },
                "Grenada": { "ja": "????", "fr": "Grenade", "es": "Granada", "de": "Grenada", "zh": "????" },
                "Costa Rica": { "ja": "?????", "fr": "Costa Rica", "es": "Costa Rica", "de": "Costa Rica", "zh": "?????" },
                "San Marino": { "ja": "?????", "fr": "Saint-Marin", "es": "San Marino", "de": "San Marino", "zh": "?????" },
                "El Salvador": { "ja": "???????", "fr": "El Salvador", "es": "El Salvador", "de": "El Salvador", "zh": "???????" },
                "Yemen": { "ja": "????", "fr": "YÃ©men", "es": "Yemen", "de": "Jemen", "zh": "????" },
                "Chile": { "ja": "??", "fr": "Chili", "es": "Chile", "de": "Chile", "zh": "??" },
                "Dominican Republic": { "ja": "???????", "fr": "RÃ©publique dominicaine", "es": "RepÃºblica Dominicana", "de": "Dominikanische Republik", "zh": "???????" },
                "Bosnia and Herzegovina": { "ja": "????Â·???????", "fr": "Bosnie-HerzÃ©govine", "es": "Bosnia y Herzegovina", "de": "Bosnien und Herzegowina", "zh": "????Â·???????" },
                "South Korea": { "ja": "??", "fr": "CorÃ©e du Sud", "es": "Corea del Sur", "de": "SÃ¼dkorea", "zh": "??" },
                "Singapore": { "ja": "??????", "fr": "Singapour", "es": "Singapur", "de": "Singapur", "zh": "??????" },
                "North Macedonia": { "ja": "??????", "fr": "MacÃ©doine du Nord", "es": "Macedonia del Norte", "de": "Nordmazedonien", "zh": "??????" },
                "Bulgaria": { "ja": "?????", "fr": "Bulgarie", "es": "Bulgaria", "de": "Bulgarien", "zh": "?????" },
                "Sweden": { "ja": "??????", "fr": "SuÃ¨de", "es": "Suecia", "de": "Schweden", "zh": "??????" },
                "Fiji": { "ja": "????", "fr": "Fidji", "es": "Fiyi", "de": "Fidschi", "zh": "????" },
                "Taiwan": { "ja": "??", "fr": "TaÃ¯wan", "es": "TaiwÃ¡n", "de": "Taiwan", "zh": "??" },
                "Estonia": { "ja": "?????", "fr": "Estonie", "es": "Estonia", "de": "Estland", "zh": "?????" },
                "Uzbekistan": { "ja": "???????", "fr": "OuzbÃ©kistan", "es": "Uzbekistan", "de": "Usbekistan", "zh": "???????" },
                "Georgia": { "ja": "?????", "fr": "GÃ©orgie", "es": "Georgia", "de": "Georgien", "zh": "?????" },
                "Honduras": { "ja": "??????", "fr": "Honduras", "es": "Honduras", "de": "Honduras", "zh": "??????" },
                "Iran": { "ja": "???", "fr": "Iran", "es": "IrÃ¡n", "de": "Iran", "zh": "???" },
                "Bhutan": { "ja": "????", "fr": "Bhoutan", "es": "ButÃ¡n", "de": "Bhutan", "zh": "????" },
                "Albania": { "ja": "?????", "fr": "Albanie", "es": "Albania", "de": "Albanien", "zh": "?????" },
                "Japan": { "ja": "??", "fr": "Japon", "es": "JapÃ³n", "de": "Japan", "zh": "??" },
                "Libya": { "ja": "???", "fr": "Libye", "es": "Libia", "de": "Libyen", "zh": "???" },
                "Tunisia": { "ja": "?????", "fr": "Tunisie", "es": "TÃºnez", "de": "Tunesien", "zh": "?????" },
                "Mongolia": { "ja": "????", "fr": "Mongolie", "es": "Mongolia", "de": "Mongolei", "zh": "????" },
                "Liechtenstein": { "ja": "?????????", "fr": "Liechtenstein", "es": "Liechtenstein", "de": "Liechtenstein", "zh": "?????????" },
                "Malta": { "ja": "???", "fr": "Malte", "es": "Malta", "de": "Malta", "zh": "???" },
                "Seychelles": { "ja": "?????", "fr": "Seychelles", "es": "Seychelles", "de": "Seychellen", "zh": "?????" },
                "Austria": { "ja": "??????", "fr": "Autriche", "es": "Austria", "de": "Ã–sterreich", "zh": "??????" },
                "Laos": { "ja": "???", "fr": "Laos", "es": "Laos", "de": "Laos", "zh": "???" },
                "Lithuania": { "ja": "?????", "fr": "Lituanie", "es": "Lituania", "de": "Litauen", "zh": "?????" },
                "Poland": { "ja": "?????", "fr": "Pologne", "es": "Polonia", "de": "Polen", "zh": "?????" },
                "United States": { "ja": "??", "fr": "Ã‰tats-Unis", "es": "Estados Unidos", "de": "Vereinigte Staaten", "zh": "??" },
                "New Zealand": { "ja": "????????", "fr": "Nouvelle-ZÃ©lande", "es": "Nueva Zelanda", "de": "Neuseeland", "zh": "????????" },
                "Ivory Coast": { "ja": "????????", "fr": "CÃ´te d'Ivoire", "es": "Costa de Marfil", "de": "ElfenbeinkÃ¼ste", "zh": "????" },
                "Cameroon": { "ja": "?????", "fr": "Cameroun", "es": "CamerÃºn", "de": "Kamerun", "zh": "?????" },
                "Nauru": { "ja": "???", "fr": "Nauru", "es": "Nauru", "de": "Nauru", "zh": "???" },
                "Armenia": { "ja": "?????", "fr": "ArmÃ©nie", "es": "Armenia", "de": "Armenien", "zh": "?????" },
                "Croatia": { "ja": "?????", "fr": "Croatie", "es": "Croacia", "de": "Kroatien", "zh": "?????" }
            };


            const translateApp = (lang) => {
                const texts = appTexts[lang];
                mainTitle.textContent = texts.mainTitle;
                subTitle.textContent = texts.subTitle;
                annieGreeting.textContent = texts.annieGreeting;
                generateBtn.textContent = texts.generateBtn;
                readPoemBtn.textContent = texts.readPoemBtn;
                loadingText.textContent = texts.loadingText;
                itineraryTitle.textContent = texts.itineraryTitle;
                errorText.textContent = texts.apiError;
                downloadPdfBtn.textContent = texts.downloadPdfBtn;

                const options = citySelect.options;
                options[0].textContent = texts.selectCity;
                for (let i = 1; i < options.length; i++) {
                    const originalCity = options[i].getAttribute('data-original-city');
                    const originalCountry = options[i].getAttribute('data-original-country');
                    
                    const translatedCity = cityTranslations[originalCity] ? cityTranslations[originalCity][lang] || originalCity : originalCity;
                    const translatedCountry = countryTranslations[originalCountry] ? countryTranslations[originalCountry][lang] || originalCountry : originalCountry;

                    options[i].textContent = `${translatedCity} (${translatedCountry})`;
                }
            };

            const populateCityDropdown = () => {
                worldCapitals.sort().forEach(cityCountry => {
                    const parts = cityCountry.match(/(.+?)\s*\((.+?)\)/);
                    if (parts && parts.length >= 3) {
                        const city = parts[1];
                        const country = parts[2];
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = cityCountry;
                        option.setAttribute('data-original-text', cityCountry);
                        option.setAttribute('data-original-city', city);
                        option.setAttribute('data-original-country', country);
                        citySelect.appendChild(option);
                    }
                });
            };

            // Helper function to strip markdown characters from poems
            const stripMarkdown = (text) => {
                return text.replace(/[*#`_]/g, '');
            };

            // Helper function to convert markdown to proper HTML
            const markdownToHtml = (markdown) => {
                let html = '';
                const lines = markdown.split('\n');
                let inList = false;

                lines.forEach(line => {
                    const trimmedLine = line.trim();

                    if (trimmedLine.startsWith('### ')) {
                        if (inList) { html += '</ul>'; inList = false; }
                        html += `<h2>${trimmedLine.substring(4)}</h2>`;
                    } else if (trimmedLine.startsWith('## ')) {
                        if (inList) { html += '</ul>'; inList = false; }
                        html += `<h2>${trimmedLine.substring(3)}</h2>`;
                    } else if (trimmedLine.startsWith('# ')) {
                        if (inList) { html += '</ul>'; inList = false; }
                        html += `<h1>${trimmedLine.substring(2)}</h1>`;
                    } else if (trimmedLine.startsWith('* ')) {
                        if (!inList) { html += '<ul>'; inList = true; }
                        html += `<li>${trimmedLine.substring(2)}</li>`;
                    } else if (trimmedLine.startsWith('---')) {
                        if (inList) { html += '</ul>'; inList = false; }
                        html += '<hr>';
                    } else {
                        if (inList) { html += '</ul>'; inList = false; }
                        if (trimmedLine !== '') {
                             html += `<p>${trimmedLine}</p>`;
                        }
                    }
                });
                if (inList) { html += '</ul>'; }

                // Process bold text after all other block elements
                html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
                
                return html;
            };

            // Helper functions for TTS audio playback
            const base64ToArrayBuffer = (base64) => {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            };

            const pcmToWav = (pcmData, sampleRate) => {
                const buffer = new ArrayBuffer(44 + pcmData.length * 2);
                const view = new DataView(buffer);

                // RIFF identifier
                writeString(view, 0, 'RIFF');
                // file length
                view.setUint32(4, 36 + pcmData.length * 2, true);
                // RIFF type
                writeString(view, 8, 'WAVE');
                // format chunk identifier
                writeString(view, 12, 'fmt ');
                // format chunk length
                view.setUint32(16, 16, true);
                // sample format (raw)
                view.setUint16(20, 1, true);
                // channel count
                view.setUint16(22, 1, true);
                // sample rate
                view.setUint32(24, sampleRate, true);
                // byte rate (sample rate * block align)
                view.setUint32(28, sampleRate * 2, true);
                // block align (channel count * bytes per sample)
                view.setUint16(32, 2, true);
                // bits per sample
                view.setUint16(34, 16, true);
                // data chunk identifier
                writeString(view, 36, 'data');
                // data chunk length
                view.setUint32(40, pcmData.length * 2, true);

                // Write the PCM data
                for (let i = 0; i < pcmData.length; i++) {
                    view.setInt16(44 + i * 2, pcmData[i], true);
                }

                return new Blob([view], { type: 'audio/wav' });
            };

            const writeString = (view, offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            const playTTSAudio = async (text) => {
                loadingText.textContent = 'Generating audio...';
                loadingIndicator.classList.remove('hidden');
                generateBtn.disabled = true;
                readPoemBtn.disabled = true;

                try {
                    const payload = {
                        contents: [{
                            parts: [{ text: text }]
                        }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: {
                                voiceConfig: {
                                    prebuiltVoiceConfig: { voiceName: "Kore" }
                                }
                            }
                        },
                        model: "gemini-2.5-flash-preview-tts"
                    };
                    const apiKey = "AIzaSyBMJpLbTxHzGxip0Z4BrSdhb7_GlF9SmEI";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`TTS API error: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);

                        if (audioSource) {
                            audioSource.stop();
                        }

                        const buffer = await audioContext.decodeAudioData(await wavBlob.arrayBuffer());
                        audioSource = audioContext.createBufferSource();
                        audioSource.buffer = buffer;
                        audioSource.connect(audioContext.destination);
                        audioSource.start();

                        audioSource.onended = () => {
                            loadingIndicator.classList.add('hidden');
                            generateBtn.disabled = false;
                            readPoemBtn.disabled = false;
                        };
                    } else {
                        throw new Error('Invalid audio data from TTS API.');
                    }
                } catch (error) {
                    console.error('TTS audio playback error:', error);
                    errorBox.textContent = appTexts[languageSelect.value].apiError;
                    errorBox.classList.remove('hidden');
                    loadingIndicator.classList.add('hidden');
                    generateBtn.disabled = false;
                    readPoemBtn.disabled = false;
                }
            };


 <!-- Tailwind CSS CDN for styling and icons -->

            const generateImage = async (prompt) => {
                loadingText.textContent = 'Generating image...';
                const payload = { instances: { prompt: prompt }, parameters: { "sampleCount": 1} };
                const apiKey = "AIzaSyBMJpLbTxHzGxip0Z4BrSdhb7_GlF9SmEI";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                const maxAttempts = 5;
                let attempt = 0;
                while (attempt < maxAttempts) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`API error: ${response.statusText}`);
                        }

                        const result = await response.json();
                        const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;

                        if (base64Data) {
                            return `data:image/png;base64,${base64Data}`;
                        } else {
                            throw new Error('Invalid image data received from API.');
                        }
                    } catch (error) {
                        attempt++;
                        console.log(`Image generation attempt ${attempt} failed. Retrying...`);
                        if (attempt >= maxAttempts) {
                            throw error;
                        }
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                    }
                }
            };
            
            const generateContent = async (city) => {
                loadingIndicator.classList.remove('hidden');
                generateBtn.disabled = true;
                outputContainer.classList.add('hidden');
                errorBox.classList.add('hidden');
                cityImage.style.display = 'none';

                const lang = languageSelect.value;
                let poemPrompt;
                let itineraryPrompt;
                const imagePrompt = `A beautiful, artistic illustration of the cityscape of ${city}, wide shot, cinematic, 16:9 aspect ratio.`;


                switch (lang) {
                    case 'fr':
                        poemPrompt = `Ã‰crivez un poÃ¨me dÃ©taillÃ© sur la capitale de ${city}. Commencez le poÃ¨me par un titre crÃ©atif sur une nouvelle ligne, suivi d'une double ligne vide, puis du contenu du poÃ¨me.`;
                        itineraryPrompt = `Fournissez un itinÃ©raire touristique dÃ©taillÃ© pour un voyage de 3 jours Ã  ${city}, incluant des conseils pratiques, des sites cÃ©lÃ¨bres et des trÃ©sors cachÃ©s. Formatez la rÃ©ponse comme un guide facile Ã  lire en utilisant des titres Markdown (##), du texte en gras (**), des listes (*) et des rÃ¨gles horizontales (---) pour sÃ©parer les sections. Ajoutez une derniÃ¨re section Ã  la fin intitulÃ©e "Informations importantes pour les Ã©trangers" qui inclut des dÃ©tails sur les prises Ã©lectriques, les langues parlÃ©es et le climat.`;
                        break;
                    case 'es':
                        poemPrompt = `Escribe un poema detallado sobre la ciudad capital de ${city}. Comienza el poema con un tÃ­tulo creativo en una nueva lÃ­nea, seguido de un doble salto de lÃ­nea, y luego el contenido del poema.`;
                        itineraryPrompt = `Proporcione un itinerario turÃ­stico detallado para un viaje de 3 dÃ­as a ${city}, incluyendo consejos prÃ¡cticos, lugares emblemÃ¡ticos famosos y joyas ocultas locales. Formatee la respuesta como una guÃ­a fÃ¡cil de leer usando encabezados de Markdown (##), texto en negrita (**), listas (*) y reglas horizontales (---) para separar las secciones. Agregue una secciÃ³n final al final titulada "InformaciÃ³n importante para extranjeros" que incluya detalles sobre enchufes elÃ©ctricos, idiomas hablados y clima.`;
                        break;
                    case 'de':
                        poemPrompt = `Schreiben Sie ein detailliertes Gedicht Ã¼ber die Hauptstadt ${city}. Beginnen Sie das Gedicht mit einem kreativen Titel in einer neuen Zeile, gefolgt von zwei leeren Zeilen, und dann den Inhalt des Gedichts.`;
                        itineraryPrompt = `Stellen Sie eine detaillierte Reiseroute fÃ¼r eine 3-tÃ¤gige Reise nach ${city} bereit, einschlieÃŸlich praktischer Tipps, berÃ¼hmter SehenswÃ¼rdigkeiten und lokaler Geheimtipps. Formatieren Sie die Antwort als einen leicht lesbaren Leitfaden mit Markdown-Ãœberschriften (##), fettem Text (**), Listen (*) und horizontalen Regeln (---) fÃ¼r den Fall, dass Sie Ihre Abschnitte trennen mÃ¼ssen. FÃ¼gen Sie am Ende einen letzten Abschnitt mit dem Titel "Wichtige Informationen fÃ¼r AuslÃ¤nder" hinzu, der Details zu Steckdosen, gesprochenen Sprachen und Klima enthÃ¤lt.`;
                        break;
                    case 'ja':
                        poemPrompt = `??${city}??????????????????????????????????????????2?????????????????????`;
                        itineraryPrompt = `${city}??3?????????????????????????????????????????????????????????????????????(##)???(**)????(*)????(---)?????????????????????????????????????????????????????????????????????????????????????????????????????????`;
                        break;
                    case 'zh':
                        poemPrompt = `???????${city}?????????????????????????,???????,?????????`;
                        itineraryPrompt = `?${city}???????3??????,??????????????????????????????????,??Markdown??(##)?????(**)???(*)????(---)???????????????â€œ???????â€?????,?????????????????????`;
                        break;
                    case 'en':
                    default:
                        poemPrompt = `Write a detailed poem about the capital city of ${city}. Start the poem with a creative title on a new line, followed by a double newline, and then the poem's content.`;
                        itineraryPrompt = `Provide a detailed tourist itinerary for a 3-day trip to ${city}, including practical tips, famous landmarks, and local hidden gems. Format the response as an easy-to-read guide using Markdown headings (##), bold text (**), lists (*), and horizontal rules (---) to separate sections. Add a final section at the end titled "Important Info for Foreigners" that includes details on electrical plugs, languages spoken, and climate.`;
                        break;
                }

                try {
                    console.log('Generating poem, itinerary, and image...');
                    const [poemResponse, itineraryResponse, imageResponse] = await Promise.all([
                        fetchContent(poemPrompt),
                        fetchContent(itineraryPrompt),
                        generateImage(imagePrompt)
                    ]);
                    
                    renderPoem(poemResponse);
                    renderItinerary(itineraryResponse);

                    if (imageResponse) {
                        cityImage.src = imageResponse;
                        cityImage.style.display = 'block';
                    }

                    outputContainer.classList.remove('hidden');
                    downloadPdfBtn.classList.remove('hidden');
                    readPoemBtn.classList.remove('hidden');

                    console.log('Content generation complete.');
                } catch (error) {
                    console.error('Failed to generate content:', error);
                    errorBox.textContent = `Error: ${error.message}`;
                    errorBox.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    generateBtn.disabled = false;
                }
            };
            
            const fetchContent = async (promptText) => {
                const payload = {
                    contents: [{
                        parts: [{ text: promptText }]
                    }],
                };
                const apiKey = "AIzaSyBMJpLbTxHzGxip0Z4BrSdhb7_GlF9SmEI"; // Canvas will provide API key at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const maxAttempts = 5;
                let attempt = 0;
                while (attempt < maxAttempts) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`API error: ${response.statusText}`);
                        }

                        const result = await response.json();
                        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                        if (generatedText) {
                            return generatedText;
                        } else {
                            throw new Error('Invalid data received from API.');
                        }
                    } catch (error) {
                        attempt++;
                        console.log(`Attempt ${attempt} failed. Retrying...`);
                        if (attempt >= maxAttempts) {
                            throw error;
                        }
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                    }
                }
            };

            const renderPoem = (content) => {
                poemContainer.innerHTML = '';
                const parts = content.split('\n\n');
                if (parts.length > 1) {
                    poemTitle.textContent = parts[0].replace(/[*#`_]/g, '');
                    const stanzas = parts.slice(1).join('\n\n').split('\n\n').filter(stanza => stanza.trim() !== '');
                    stanzas.forEach(stanzaText => {
                        const stanzaElement = document.createElement('p');
                        stanzaElement.className = 'mb-4 p-2 rounded-lg stanza relative';
                        const cleanedStanzaText = stripMarkdown(stanzaText);
                        stanzaElement.innerHTML = `<span class="pr-12">${cleanedStanzaText.replace(/\n/g, '<br>')}</span><button class="absolute top-1/2 right-4 transform -translate-y-1/2 play-stanza-btn text-blue-400 hover:text-blue-200 transition-colors">??</button>`;
                        poemContainer.appendChild(stanzaElement);
                    });
                } else {
                    poemTitle.textContent = appTexts[languageSelect.value].poemTitle;
                    const stanzas = content.split('\n\n').filter(stanza => stanza.trim() !== '');
                    stanzas.forEach(stanzaText => {
                        const stanzaElement = document.createElement('p');
                        stanzaElement.className = 'mb-4 p-2 rounded-lg stanza relative';
                        const cleanedStanzaText = stripMarkdown(stanzaText);
                        stanzaElement.innerHTML = `<span class="pr-12">${cleanedStanzaText.replace(/\n/g, '<br>')}</span><button class="absolute top-1/2 right-4 transform -translate-y-1/2 play-stanza-btn text-blue-400 hover:text-blue-200 transition-colors">??</button>`;
                        poemContainer.appendChild(stanzaElement);
                    });
                }
            };

            const renderItinerary = (content) => {
                itineraryContainer.innerHTML = '';
                itineraryContainer.innerHTML = markdownToHtml(content);
            };

            poemContainer.addEventListener('click', (e) => {
                const clickedStanza = e.target.closest('.stanza');
                if (clickedStanza) {
                    if (lastClickedStanza) {
                        lastClickedStanza.style.backgroundColor = 'transparent';
                    }
                    const newColor = stanzaColors[Math.floor(Math.random() * stanzaColors.length)];
                    clickedStanza.style.backgroundColor = newColor;
                    lastClickedStanza = clickedStanza;
                }
            });

            // Event delegation for stanza play buttons
            poemContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('play-stanza-btn')) {
                    const stanzaText = e.target.previousElementSibling.textContent;
                    if (stanzaText) {
                        playTTSAudio(stanzaText);
                    }
                }
            });
            
            readPoemBtn.addEventListener('click', () => {
                const fullPoemText = Array.from(poemContainer.querySelectorAll('span')).map(span => span.textContent).join('\n\n');
                if (fullPoemText) {
                    playTTSAudio(fullPoemText);
                }
            });

            generateBtn.addEventListener('click', () => {
                const selectedCity = citySelect.value;
                if (!selectedCity) {
                    errorBox.textContent = appTexts[languageSelect.value].selectCityError;
                    errorBox.classList.remove('hidden');
                    return;
                }
                generateContent(selectedCity);
            });

            downloadPdfBtn.addEventListener('click', () => {
                const selectedCity = citySelect.value;
                const lang = languageSelect.value;
                const cityAndCountry = citySelect.options[citySelect.selectedIndex].textContent;

                const doc = new window.jspdf.jsPDF('p', 'pt', 'a4');
                const margin = 72;
                let y = margin;
                const lineHeight = 12;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const today = new Date().toLocaleDateString(lang);
                
                // Add header and footer
                const addHeaderAndFooter = (pdfDoc) => {
                    const pageNumber = pdfDoc.internal.getNumberOfPages();
                    pdfDoc.setFont('Helvetica', 'normal');
                    pdfDoc.setFontSize(10);
                    pdfDoc.setTextColor('#333333');
                    pdfDoc.text(`${appTexts[lang].mainTitle} - ${cityAndCountry} | ${today}`, pageWidth / 2, 36, { align: 'center' });
                    pdfDoc.text(`Page ${pageNumber}`, pageWidth / 2, pageHeight - 36, { align: 'center' });
                };

                // Add content with auto-pagination
                const addContent = (pdfDoc, text, size, style = 'normal', align = 'left', startY) => {
                    let cursorY = startY;
                    const splitText = pdfDoc.splitTextToSize(text, pageWidth - margin * 2);

                    splitText.forEach(line => {
                        if (cursorY + lineHeight > pageHeight - margin) {
                            pdfDoc.addPage();
                            addHeaderAndFooter(pdfDoc);
                            cursorY = margin;
                        }
                        pdfDoc.setFont('Helvetica', style);
                        pdfDoc.setFontSize(size);
                        pdfDoc.setTextColor('#000');
                        pdfDoc.text(line, margin, cursorY, { align: align });
                        cursorY += lineHeight;
                    });
                    return cursorY;
                };

                const parseHtmlAndAddToPdf = (pdfDoc, startY) => {
                    let y = startY;
                    const itineraryElements = Array.from(itineraryContainer.children);
                    const listIndent = 15;

                    itineraryElements.forEach(element => {
                        if (element.tagName === 'H2') {
                            const textContent = element.textContent.replace(/\s+/g, ' ').trim();
                            if (y + 20 > pageHeight - margin) {
                                pdfDoc.addPage();
                                addHeaderAndFooter(pdfDoc);
                                y = margin;
                            }
                            y = addContent(pdfDoc, textContent, 14, 'bold', 'left', y);
                            y += 10;
                        } else if (element.tagName === 'P') {
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = element.innerHTML;
                            const textNodes = Array.from(tempDiv.childNodes);
                            
                            let currentX = margin;
                            let currentY = y;
                            
                            textNodes.forEach(node => {
                                let nodeText = node.textContent;
                                let nodeStyle = 'normal';
                                if (node.tagName === 'STRONG') {
                                    nodeStyle = 'bold';
                                }
                                
                                pdfDoc.setFont('Helvetica', nodeStyle);
                                pdfDoc.setFontSize(12);

                                const textLines = doc.splitTextToSize(nodeText, pageWidth - margin * 2 - (currentX - margin));

                                textLines.forEach((line, index) => {
                                    if (currentY + lineHeight > pageHeight - margin) {
                                        pdfDoc.addPage();
                                        addHeaderAndFooter(pdfDoc);
                                        currentY = margin;
                                        currentX = margin;
                                    }
                                    pdfDoc.text(line, currentX, currentY);
                                    if (index < textLines.length - 1) {
                                        currentY += lineHeight;
                                        currentX = margin;
                                    } else {
                                        currentX += pdfDoc.getStringUnitWidth(line) * 12;
                                    }
                                });
                            });
                            y = currentY + 10;
                        } else if (element.tagName === 'UL') {
                            const listItems = Array.from(element.querySelectorAll('li'));
                            listItems.forEach(li => {
                                const listItemText = `â€¢ ${li.textContent.replace(/\s+/g, ' ').trim()}`;
                                const listItemLines = doc.splitTextToSize(listItemText, pageWidth - 2 * margin - listIndent);
                                const listItemHeight = listItemLines.length * lineHeight;
                                if (y + listItemHeight > pageHeight - margin) {
                                    doc.addPage();
                                    addHeaderAndFooter(doc);
                                    y = margin;
                                }
                                doc.text(listItemLines, margin + listIndent, y);
                                y += listItemLines.length * lineHeight;
                                y += 3;
                            });
                            y += 5;
                        } else if (element.tagName === 'HR') {
                            if (y > pageHeight - margin) {
                                doc.addPage();
                                addHeaderAndFooter(doc);
                                y = margin;
                            }
                            doc.line(margin, y, pageWidth - margin, y);
                            y += 10;
                        }
                    });
                    return y;
                };

                // Function to add image to PDF
                const addImageToPdf = (pdfDoc, imageData, yPosition) => {
                    let cursorY = yPosition;
                    if (imageData && imageData !== 'data:image/png;base64,') {
                        const img = new Image();
                        img.src = imageData;
                        const aspectRatio = 16 / 9; // Desired 16:9 aspect ratio
                        const maxWidth = pageWidth - margin * 2;
                        let newWidth = maxWidth;
                        let newHeight = newWidth / aspectRatio;

                        if (cursorY + newHeight > pageHeight - margin) {
                            newHeight = pageHeight - cursorY - margin - 20;
                            newWidth = newHeight * aspectRatio;
                        }

                        if (cursorY + newHeight > pageHeight - margin) {
                            pdfDoc.addPage();
                            addHeaderAndFooter(pdfDoc);
                            cursorY = margin;
                        }

                        pdfDoc.addImage(imageData, 'PNG', margin + (maxWidth - newWidth) / 2, cursorY, newWidth, newHeight);
                        cursorY += newHeight + 20; // Add some space after the image
                    }
                    return cursorY;
                };

                // Main PDF generation flow
                doc.addPage();
                addHeaderAndFooter(doc);
                y = addImageToPdf(doc, cityImage.src, y);
                
                y = addContent(doc, poemTitle.textContent, 18, 'bold', 'center', y);
                y += 10;
                const poemStanzas = document.querySelectorAll('#poemContainer p');
                poemStanzas.forEach(p => {
                    const stanzaText = p.querySelector('span').textContent;
                    y = addContent(doc, stanzaText, 12, 'normal', 'left', y);
                    y += 5;
                });
                
                doc.addPage();
                addHeaderAndFooter(doc);
                y = addContent(doc, itineraryTitle.textContent, 18, 'bold', 'center', y);
                y += 20;
                
                parseHtmlAndAddToPdf(doc, y);
                
                doc.save(`${selectedCity}_tour_guide.pdf`);
            });

            languageSelect.addEventListener('change', (e) => {
                translateApp(e.target.value);
            });
            
            populateCityDropdown();
        });
    </script>
</body>
</html>
